<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Projector: Geometry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Projector
   </div>
   <div id="projectbrief">Monte Carlo Photon transport simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_02_geometry.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Geometry </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md19">Computational solid geometry</a></li>
<li class="level1"><a href="#autotoc_md20">Supported surfaces</a><ul><li class="level2"><a href="#autotoc_md21">Generic plane</a></li>
<li class="level2"><a href="#autotoc_md22">Ellipsoid</a></li>
<li class="level2"><a href="#autotoc_md23">Elliptic cone</a></li>
<li class="level2"><a href="#autotoc_md24">Elliptic cylinder</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md25">Helper surfaces</a><ul><li class="level2"><a href="#autotoc_md26">Box</a></li>
<li class="level2"><a href="#autotoc_md27">Capped cylinder</a></li>
<li class="level2"><a href="#autotoc_md28">Capped cone</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md29">Bounding box calculation</a></li>
<li class="level1"><a href="#autotoc_md30">Sampling random points from a CSG tree</a></li>
<li class="level1"><a href="#autotoc_md31">Distance to collision of a particle and a surface</a></li>
<li class="level1"><a href="#autotoc_md32">Determining distance to closest surface of a travelling particle</a></li>
</ul>
</div>
<div class="textblock"><p>Projector uses similar approach to geometry as other particle transport simulators, a combination of <a href="https://en.wikipedia.org/wiki/Constructive_solid_geometry">computational solid geometry</a> and <a href="https://en.wikipedia.org/wiki/Quadric">quadric</a> surfaces that define half-spaces. Quadrics are generic definitions of surfaces in 3D that allow algorithmic calculation of intersection between particle and the surface. They are also simple to define primitive shapes with (and some primitives are directly a quadric surface, ie. a sphere). CSG allows us to build complex geometries from primitives and it is both simple to grasp conceptually and to run algorithmic calculations on.</p>
<p>All the geometry in projector uses cartesian coordinate system, although some calculation steps might temporarily change to polar or other coordinate system.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Computational solid geometry</h1>
<p>CSG works by composing primitives into a binary tree structure using boolean operators. Project supports 3 basic operators - union, intersection and substraction. These operations are quite self-descriptive. There are two notations used interchangeably in Projector.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">Operation   </th><th class="markdownTableHeadCenter">Set notation   </th><th class="markdownTableHeadCenter">Algebraic notation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Union   </td><td class="markdownTableBodyCenter">\( \cup \)   </td><td class="markdownTableBodyCenter">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Intersect   </td><td class="markdownTableBodyCenter">\( \cap \)   </td><td class="markdownTableBodyCenter">*    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Substract   </td><td class="markdownTableBodyCenter" colspan="2">-   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md20"></a>
Supported surfaces</h1>
<h2><a class="anchor" id="autotoc_md21"></a>
Generic plane</h2>
<p>A generic 2D plane. When the normal vector is axis aligned, the plane is also axis aligned and the plane can be bounded in one direction. Has 2 parameters, point <code>P</code> ("center") on the plane and the normal vector <code>N</code>. The surface equation is as follows:</p>
<p class="formulaDsp">
\[ P = (x_0, y_0, z_0) \\ N = (a, b, c) \\ a(x - x_0) + b(y - y_0) + c(z - z_0) = 0 \]
</p>
<p>As is common in computer graphics, the normal vector points "out" of the volume, so any point on the oppossite side is "inside" the plane when using the plane to construct complex geometry.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Ellipsoid</h2>
<p>Ellipsoid is a the generalization of a sphere, with different radii for each axis. It is defined by 4 parameters, the center <code>C</code> and the radii for each axis <code>a, b, c</code>. The surface equation is following:</p>
<p class="formulaDsp">
\[ C = (x_0, y_0, z_0) \\ \frac{(x - x_0)^2}{a^2} + \frac{(y - y_0)^2}{b^2} + \frac{(z - z_0)^2}{c^2} - 1 = 0 \]
</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Elliptic cone</h2>
<p>There are 3 variants of the cone, each for one axis. Following equations are for z-cone. The equations for other axis variants differ in the sign of the fractions. The cone apex is located at the point <code>C</code>.</p>
<p class="formulaDsp">
\[ C = (x_0, y_0, z_0) \\ \frac{(x - x_0)^2}{a^2} + \frac{(y - y_0)^2}{b^2} - \frac{(z - z_0)^2}{c^2} = 0 \]
</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Elliptic cylinder</h2>
<p>The cylinder is infinite and axis aligned. Following equations are for a z-cylinder. Other axis variants differ in the coordinates used to calculate the surface (x-axis uses y and z and vice versa). The cylinder is centered around point <code>C</code>.</p>
<p class="formulaDsp">
\[ C = (x_0, y_0, z_0) \\ \frac{(x - x_0)^2}{a^2} + \frac{(y - y_0)^2}{b^2} - 1 = 0 \]
</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Helper surfaces</h1>
<p>Projector provides several helper surfaces for creating common geometric constructs. They are internally converted to the typical surface representation.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Box</h2>
<p>This is a simple axis-aligned box, consisting of 6 surfaces. It is defined by 2 parameters, the min and max coordinates:</p>
<p class="formulaDsp">
\[ (x_{min}, y_{min}, z_{min}), (x_{max}, y_{max}, z_{max}) \]
</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Capped cylinder</h2>
<p>The cylinder has 1 more parameter <code>h</code>, which defines two planes along the cylinder axis, perpendicular to it. The planes are distanced <code>h/2</code> from the center point symmetrically.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Capped cone</h2>
<p>There are two additional parameters, <code>d1</code> and <code>d2</code>. They define the location of two planes. The plane defined by <code>d1</code> is this distance away from the center point of the cone and it's normal points to the positive direction. The plane defined by <code>d2</code> is similar, but the normal points to the negative direction.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Bounding box calculation</h1>
<p>We often need a bounding box for the geometry for various calculations, most notably sampling volumes and for acceleration of finding closest surfaces. For some geometries, it can be easily computed - ellipsoids, cylinders, cuboids, capped cone. Generic surfaces on the other hand usually can't be bounded, as they extend to infinity in one or more directions. Multiple combined surfaces can be bounded, although some solutions are hard to compute algorithmically (ie. intersection of two generic planes). Projector allows the user to define the bounding box manually (prefered) or it can do simple approximation of the bounding box (not tight) automatically when the bounding box is not supplied.</p>
<p>Some surfaces have easily computable bounds, which means we can construct a bounding box with atleast one axis that is not infinite. Those surfaces are: plane parallel to axis, ellipsoid, elliptic cylinder, elliptic cone. By traversing the tree of the geometry, calculating the bounding boxes of the elements and combining them according to following rules, we can calculate the approximation of the bounding box of the geometry. By also combining this bounding box with the bounds of the simulation, we get a bounding box that is always finite and in worst case spans the whole simulation environment.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operation   </th><th class="markdownTableHeadNone">min bounding box rule   </th><th class="markdownTableHeadNone">max bounding box rule    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\( A \cup B \)   </td><td class="markdownTableBodyNone">\( \min (A, B) \)   </td><td class="markdownTableBodyNone">\( \max (A, B) \)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\( A \cap B \)   </td><td class="markdownTableBodyNone">\( \max (A, B) \)   </td><td class="markdownTableBodyNone">\( \min (A, B) \)   </td></tr>
</table>
<p>\( A - B \) | \( A \)</p>
<h1><a class="anchor" id="autotoc_md30"></a>
Sampling random points from a CSG tree</h1>
<p>Currently the simulator takes a simple approach to sampling random poitns from a CSG tree:</p>
<ol type="1">
<li>Sample random point from bounding box of the geometry</li>
<li>Check whether the point is in the geometry</li>
<li>Sample again or return the sampled point</li>
</ol>
<h1><a class="anchor" id="autotoc_md31"></a>
Distance to collision of a particle and a surface</h1>
<p>For geometry purposes, particle is defined by it's current position \(p\) and direction vector \(d\) (unit vector). If we take a generic surface defined by function \( F(x) = 0 \), we can define the intersection point of the particle and surface: \(F(p + t * d) = 0\). By solving for parameter \(t\), we get the distance. As the direction vector is a unit vector, this parameter is the distance to the collision.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Determining distance to closest surface of a travelling particle</h1>
<p>TODO: determine the algorithm for this. Currently we just find the surface with smallest distance, which is not true when working with CSG geometries! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
